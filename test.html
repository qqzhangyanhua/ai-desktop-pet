<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live2D Test</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: system-ui, -apple-system, sans-serif;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      margin: 0 0 20px 0;
      font-size: 24px;
    }
    .info {
      padding: 12px;
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      border-radius: 4px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .status {
      padding: 12px;
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      border-radius: 4px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .status.success {
      background: #e8f5e9;
      border-left-color: #4caf50;
    }
    .status.error {
      background: #ffebee;
      border-left-color: #f44336;
    }
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    .log {
      margin-top: 20px;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .log-entry:last-child {
      border-bottom: none;
    }
    .log-time {
      color: #999;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ± Live2D æµ‹è¯•é¡µé¢</h1>
    
    <div class="info">
      <strong>æµ‹è¯•ç›®çš„ï¼š</strong>éªŒè¯ Live2D æ¨¡å‹èƒ½å¦æ­£å¸¸åŠ è½½å’Œæ¸²æŸ“
    </div>
    
    <div id="status" class="status">
      <strong>çŠ¶æ€ï¼š</strong>ç­‰å¾…åˆå§‹åŒ–...
    </div>
    
    <div class="controls">
      <button onclick="loadLive2D()">åŠ è½½ Live2D</button>
      <button onclick="testMotion()">æµ‹è¯•åŠ¨ä½œ</button>
      <button onclick="testMessage()">æµ‹è¯•æ¶ˆæ¯</button>
      <button onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="log" id="log"></div>
  </div>

  <script type="module">
    let oml2d = null;
    let isLoaded = false;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
      entry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    function updateStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.className = `status ${type}`;
      statusDiv.innerHTML = `<strong>çŠ¶æ€ï¼š</strong>${message}`;
    }

    window.loadLive2D = async function() {
      log('å¼€å§‹åŠ è½½ oh-my-live2d åº“...');
      updateStatus('æ­£åœ¨åŠ è½½...', 'info');

      try {
        // åŠ¨æ€å¯¼å…¥ oh-my-live2d
        const { loadOml2d } = await import('https://unpkg.com/oh-my-live2d@0.19.3/dist/index.js');
        log('âœ“ oh-my-live2d åº“åŠ è½½æˆåŠŸ');

        const config = {
          models: [
            {
              name: 'white-cat',
              path: '/whitecatfree_vts/white-cat.model3.json',
              scale: 0.15,
              position: [0, 60],
              stageStyle: {
                height: 400,
                width: 300,
              },
            }
          ],
          dockedPosition: 'right',
          primaryColor: '#58b0fc',
          sayHello: false,
          tips: {
            idleTips: {
              wordTheDay: false,
            },
          },
          statusBar: {
            disable: true,
          },
          menus: {
            disable: true,
          },
        };

        log('é…ç½®ä¿¡æ¯ï¼š' + JSON.stringify(config, null, 2));
        log('å¼€å§‹åˆ›å»º Live2D å®ä¾‹...');

        oml2d = loadOml2d(config);

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        oml2d.onLoad((status) => {
          if (status === 'success') {
            log('âœ“ Live2D æ¨¡å‹åŠ è½½æˆåŠŸï¼');
            updateStatus('Live2D æ¨¡å‹åŠ è½½æˆåŠŸï¼', 'success');
            isLoaded = true;
          } else {
            log('âœ— Live2D æ¨¡å‹åŠ è½½å¤±è´¥ï¼š' + status, 'error');
            updateStatus('Live2D æ¨¡å‹åŠ è½½å¤±è´¥', 'error');
          }
        });

        oml2d.onLoadError?.((error) => {
          log('âœ— åŠ è½½é”™è¯¯ï¼š' + JSON.stringify(error), 'error');
          updateStatus('åŠ è½½é”™è¯¯ï¼š' + error.message, 'error');
        });

        log('å¼€å§‹åŠ è½½æ¨¡å‹ç´¢å¼• 0...');
        setTimeout(() => {
          oml2d.loadModelByIndex(0)
            .then(() => {
              log('âœ“ loadModelByIndex(0) è°ƒç”¨æˆåŠŸ');
            })
            .catch((err) => {
              log('âœ— loadModelByIndex(0) å¤±è´¥ï¼š' + err.message, 'error');
              updateStatus('æ¨¡å‹åŠ è½½å¤±è´¥', 'error');
            });
        }, 100);

      } catch (error) {
        log('âœ— åˆå§‹åŒ–å¤±è´¥ï¼š' + error.message, 'error');
        updateStatus('åˆå§‹åŒ–å¤±è´¥ï¼š' + error.message, 'error');
        console.error(error);
      }
    };

    window.testMotion = function() {
      if (!isLoaded) {
        log('âš  è¯·å…ˆåŠ è½½ Live2D æ¨¡å‹', 'warning');
        return;
      }
      log('æµ‹è¯•åŠ¨ä½œï¼šæ˜¾ç¤ºæ¶ˆæ¯');
      oml2d?.tipsMessage('æµ‹è¯•åŠ¨ä½œæ¶ˆæ¯ï¼', 3000, 5);
    };

    window.testMessage = function() {
      if (!isLoaded) {
        log('âš  è¯·å…ˆåŠ è½½ Live2D æ¨¡å‹', 'warning');
        return;
      }
      const messages = [
        'ä½ å¥½å‘€~ ğŸ±',
        'æˆ‘æ˜¯ Live2D æ¨¡å‹',
        'ç‚¹å‡»æˆ‘è¯•è¯•å§ï¼',
        'å–µ~ à¸…(ï¼¾ãƒ»Ï‰ãƒ»ï¼¾à¸…)',
      ];
      const message = messages[Math.floor(Math.random() * messages.length)];
      log('æ˜¾ç¤ºæ¶ˆæ¯ï¼š' + message);
      oml2d?.tipsMessage(message, 3000, 5);
    };

    window.clearLogs = function() {
      document.getElementById('log').innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º');
    };

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åˆå§‹åŒ–
    log('é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡å°±ç»ª');
    log('æ¨¡å‹è·¯å¾„ï¼š/whitecatfree_vts/white-cat.model3.json');
    log('ç‚¹å‡»"åŠ è½½ Live2D"æŒ‰é’®å¼€å§‹');
  </script>
</body>
</html>
