<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live2D è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    h1 {
      margin-top: 0;
      font-size: 28px;
    }
    h2 {
      margin-top: 0;
      font-size: 20px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
      padding-bottom: 10px;
    }
    .status {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      margin: 10px 0;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
    }
    .status.ok { border-left: 4px solid #10b981; }
    .status.error { border-left: 4px solid #ef4444; }
    .status.warn { border-left: 4px solid #f59e0b; }
    button {
      background: white;
      color: #667eea;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    #log {
      background: rgba(0, 0, 0, 0.5);
      padding: 15px;
      border-radius: 8px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Live2D è¯Šæ–­å·¥å…·</h1>

    <div class="section">
      <h2>ç³»ç»Ÿæ£€æŸ¥</h2>
      <div id="system-check"></div>
    </div>

    <div class="section">
      <h2>Live2D èˆå°æ£€æŸ¥</h2>
      <div id="stage-check"></div>
      <button onclick="checkLive2DStage()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="section">
      <h2>è¯Šæ–­æ—¥å¿—</h2>
      <div id="log"></div>
    </div>
  </div>

  <script>
    const log = (msg, type = 'info') => {
      const logEl = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#ef4444' : type === 'warn' ? '#f59e0b' : '#10b981';
      logEl.innerHTML += `<span style="color: ${color}">[${timestamp}] ${msg}</span>\n`;
      logEl.scrollTop = logEl.scrollHeight;
    };

    const addStatus = (containerId, label, value, status) => {
      const container = document.getElementById(containerId);
      const div = document.createElement('div');
      div.className = `status ${status}`;
      div.innerHTML = `<span>${label}</span><span>${value}</span>`;
      container.appendChild(div);
    };

    // ç³»ç»Ÿæ£€æŸ¥
    function checkSystem() {
      const systemCheck = document.getElementById('system-check');
      systemCheck.innerHTML = '';

      // Node.js ç‰ˆæœ¬ï¼ˆå¦‚æœå¯è®¿é—®ï¼‰
      addStatus('system-check', 'User Agent', navigator.userAgent, 'ok');
      addStatus('system-check', 'Window Size', `${window.innerWidth}x${window.innerHeight}`, 'ok');
      addStatus('system-check', 'Device Pixel Ratio', window.devicePixelRatio, 'ok');

      log('ç³»ç»Ÿæ£€æŸ¥å®Œæˆ');
    }

    // Live2D èˆå°æ£€æŸ¥
    function checkLive2DStage() {
      const stageCheck = document.getElementById('stage-check');
      stageCheck.innerHTML = '';

      const stage = document.getElementById('oml2d-stage');
      const canvas = document.getElementById('oml2d-canvas');
      const wrapper = document.querySelector('.oml2d-wrapper');

      if (stage) {
        const rect = stage.getBoundingClientRect();
        const computed = window.getComputedStyle(stage);
        addStatus('stage-check', '#oml2d-stage å­˜åœ¨', 'âœ“', 'ok');
        addStatus('stage-check', '  ä½ç½®', `${rect.x}, ${rect.y}`, rect.x >= 0 && rect.y >= 0 ? 'ok' : 'warn');
        addStatus('stage-check', '  å°ºå¯¸', `${rect.width}x${rect.height}`, rect.width > 0 && rect.height > 0 ? 'ok' : 'error');
        addStatus('stage-check', '  z-index', computed.zIndex, 'ok');
        addStatus('stage-check', '  visibility', computed.visibility, computed.visibility === 'visible' ? 'ok' : 'error');
        addStatus('stage-check', '  opacity', computed.opacity, parseFloat(computed.opacity) > 0 ? 'ok' : 'error');
        addStatus('stage-check', '  display', computed.display, computed.display !== 'none' ? 'ok' : 'error');
        log('æ‰¾åˆ° #oml2d-stage å…ƒç´ ');
      } else {
        addStatus('stage-check', '#oml2d-stage', 'âœ— ä¸å­˜åœ¨', 'error');
        log('æœªæ‰¾åˆ° #oml2d-stage å…ƒç´ ', 'error');
      }

      if (canvas) {
        const rect = canvas.getBoundingClientRect();
        const computed = window.getComputedStyle(canvas);
        addStatus('stage-check', '#oml2d-canvas å­˜åœ¨', 'âœ“', 'ok');
        addStatus('stage-check', '  Canvas å°ºå¯¸', `${canvas.width}x${canvas.height}`, canvas.width > 0 && canvas.height > 0 ? 'ok' : 'error');
        addStatus('stage-check', '  æ˜¾ç¤ºå°ºå¯¸', `${rect.width}x${rect.height}`, rect.width > 0 && rect.height > 0 ? 'ok' : 'error');
        addStatus('stage-check', '  visibility', computed.visibility, computed.visibility === 'visible' ? 'ok' : 'error');
        addStatus('stage-check', '  opacity', computed.opacity, parseFloat(computed.opacity) > 0 ? 'ok' : 'error');
        log('æ‰¾åˆ° #oml2d-canvas å…ƒç´ ');
      } else {
        addStatus('stage-check', '#oml2d-canvas', 'âœ— ä¸å­˜åœ¨', 'error');
        log('æœªæ‰¾åˆ° #oml2d-canvas å…ƒç´ ', 'error');
      }

      if (wrapper) {
        addStatus('stage-check', '.oml2d-wrapper å­˜åœ¨', 'âœ“', 'ok');
        log('æ‰¾åˆ° .oml2d-wrapper å…ƒç´ ');
      } else {
        addStatus('stage-check', '.oml2d-wrapper', 'âœ— ä¸å­˜åœ¨', 'warn');
        log('æœªæ‰¾åˆ° .oml2d-wrapper å…ƒç´ ', 'warn');
      }

      if (!stage && !canvas && !wrapper) {
        log('Live2D å°šæœªåˆå§‹åŒ–ï¼Œè¯·ç¨åé‡è¯•', 'warn');
      }
    }

    // åˆå§‹åŒ–
    log('è¯Šæ–­å·¥å…·å·²å¯åŠ¨');
    checkSystem();

    // å®šæœŸæ£€æŸ¥ Live2D èˆå°
    let checkCount = 0;
    const interval = setInterval(() => {
      checkCount++;
      log(`è‡ªåŠ¨æ£€æŸ¥ Live2D èˆå° (${checkCount}/10)...`);
      checkLive2DStage();

      const stage = document.getElementById('oml2d-stage');
      if (stage || checkCount >= 10) {
        clearInterval(interval);
        if (stage) {
          log('âœ“ Live2D èˆå°å·²æ£€æµ‹åˆ°ï¼Œåœæ­¢è‡ªåŠ¨æ£€æŸ¥', 'info');
        } else {
          log('âœ— 10 æ¬¡æ£€æŸ¥åä»æœªå‘ç° Live2D èˆå°', 'error');
        }
      }
    }, 2000);
  </script>
</body>
</html>
