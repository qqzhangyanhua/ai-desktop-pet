# Sprint 4 端到端测试清单

**日期**: 2025-12-26
**测试范围**: Phase 1 宠物养成系统

---

## 1. 初始化测试

### 1.1 首次启动测试
- [ ] App启动后自动加载pet_status
- [ ] 首次启动创建默认记录（mood=50, energy=50, intimacy=0）
- [ ] 控制台日志显示初始化顺序：
  ```
  [App] Database initialized
  [App] Config loaded
  [App] Pet status loaded
  [App] Scheduler initialized
  ```

### 1.2 现有用户升级测试
- [ ] 现有用户打开应用后正常工作
- [ ] 不会重置现有数据

---

## 2. 属性显示测试

### 2.1 StatusBar显示
- [ ] 心情（mood）值正确显示，颜色为黄色 (#FFD93D)
- [ ] 精力（energy）值正确显示，颜色为绿色 (#6BCB77)
- [ ] 亲密（intimacy）值正确显示，颜色为粉色 (#FF6B9D)
- [ ] 进度条宽度与数值匹配（0-100%）
- [ ] 数值变化时有平滑过渡动画（0.5s ease）

### 2.2 属性衰减测试
- [ ] 关闭应用
- [ ] 等待5分钟
- [ ] 重新打开应用
- [ ] 验证：mood和energy有衰减（每分钟-0.5）
- [ ] 验证：intimacy不衰减

**预期结果**:
- 5分钟后：mood和energy各减少约2.5

---

## 3. 互动系统测试

### 3.1 区域点击检测
- [ ] 点击宠物上部1/3区域 → 触发"抚摸"互动（pet）
- [ ] 点击宠物中部1/3区域 → 触发"喂食"互动（feed）
- [ ] 点击宠物下部1/3区域 → 触发"玩耍"互动（play）

### 3.2 点击vs拖动识别
- [ ] 快速点击 → 触发互动
- [ ] 拖动窗口（移动距离>5px） → 不触发互动，窗口移动
- [ ] `data-tauri-drag-region` 功能保持正常

### 3.3 互动效果验证

#### 抚摸（pet）
- [ ] mood 增加 +5
- [ ] intimacy 增加 +2
- [ ] 飘字显示"抚摸 +5"，颜色粉色
- [ ] 控制台日志：`[PetContainer] Interaction success: pet +5`

#### 喂食（feed）
- [ ] energy 增加 +10
- [ ] intimacy 增加 +1
- [ ] 飘字显示"喂食 +10"，颜色绿色

#### 玩耍（play）
- [ ] mood 增加 +8
- [ ] energy 减少 -5
- [ ] intimacy 增加 +3
- [ ] 飘字显示"玩耍 +8"，颜色黄色

### 3.4 冷却时间测试
- [ ] 连续点击同一互动
- [ ] 第二次点击应显示冷却提示
- [ ] 等待冷却时间结束后可再次互动
- [ ] 不同互动类型的冷却独立计算

**冷却时间**:
- pet: 30秒
- feed: 60秒
- play: 45秒

### 3.5 飘字动画测试
- [ ] 飘字从点击位置向上浮动60px
- [ ] 动画持续1秒
- [ ] 显示格式："[标签] +[数值]"
- [ ] 支持多个飘字同时显示
- [ ] 1秒后自动消失

---

## 4. 表情系统测试

### 4.1 Mood-based表情
- [ ] mood > 80 → excited/happy
- [ ] mood 50-80 → neutral
- [ ] mood < 50 → sad
- [ ] mood < 20 → sad (低落)

### 4.2 Energy影响
- [ ] energy < 20 → neutral（疲惫状态优先）
- [ ] energy >= 20 → 由mood决定

### 4.3 表情切换
- [ ] 通过互动改变mood/energy
- [ ] 验证表情自动切换
- [ ] Live2D模型（如果启用）或占位符显示正确表情
- [ ] 控制台日志：`[usePetStatus] Emotion updated: neutral → happy ...`

---

## 5. 兼容性测试

### 5.1 与其他功能共存
- [ ] 右键菜单功能正常
- [ ] 对话功能不受影响
- [ ] 设置面板正常打开
- [ ] 窗口拖动不受影响

### 5.2 Live2D集成
- [ ] useLive2D = false：占位符正常显示互动
- [ ] useLive2D = true：Live2D模型正常加载
- [ ] Live2D模型接收emotion更新

---

## 6. 性能测试

### 6.1 响应速度
- [ ] 点击响应延迟 < 100ms
- [ ] 飘字动画流畅，无卡顿
- [ ] StatusBar更新流畅

### 6.2 资源占用
- [ ] 数据库写入频率合理（< 1次/秒）
- [ ] 内存占用稳定，无泄漏
- [ ] CPU占用正常

### 6.3 数据库性能
- [ ] 属性保存正常（每次互动后）
- [ ] 查询速度快 (< 50ms)
- [ ] 无数据库锁定问题

---

## 7. 边界情况测试

### 7.1 属性边界
- [ ] mood达到100后不再增加
- [ ] mood达到0后不再减少
- [ ] energy同样有0-100边界
- [ ] intimacy可以超过100（无上限）

### 7.2 错误处理
- [ ] 数据库连接失败时有错误提示
- [ ] 互动失败时有友好提示
- [ ] 不会导致应用崩溃

---

## 测试结果汇总

**测试日期**: _________
**测试人员**: Claude Code
**通过率**: _____ / _____

### 发现的问题
1.
2.
3.

### 需要优化的地方
1.
2.
3.

---

## 附录：测试数据

### 初始状态
```json
{
  "mood": 50,
  "energy": 50,
  "intimacy": 0,
  "lastInteraction": [timestamp],
  "lastFeed": 0,
  "lastPlay": 0,
  "totalInteractions": 0
}
```

### 互动配置
参考：`src/services/pet-status/interaction.ts`
