# P0 快捷键功能测试清单

## 测试环境
- 日期: 2025-12-29
- 版本: 当前开发版本

## 自动化检查

### ✅ 代码质量检查
- [x] TypeScript 类型检查通过 (tsc --noEmit)
- [x] 无编译错误
- [x] WindowManager 服务正确导出

### ✅ 架构改进验证
- [x] 创建了 WindowManager 单例服务
- [x] ShortcutManager 使用 WindowManager（代码从28行减少到4行）
- [x] ContextMenu 使用 WindowManager（代码从40行减少到6行）
- [x] App.tsx 托盘菜单使用 WindowManager（代码从25行减少到4行）
- [x] 消除了3处代码重复

## 手工测试清单

### 测试 1: 右键菜单打开窗口
**步骤:**
1. 启动应用: `pnpm tauri dev`
2. 右键点击宠物 → 打开右键菜单
3. 点击「聊天」菜单项
4. 验证聊天窗口是否打开
5. 再次点击「聊天」菜单项
6. 验证是否聚焦已存在的窗口（而非创建新窗口）
7. 点击「设置中心」菜单项
8. 验证设置窗口是否打开

**预期结果:**
- [ ] 聊天窗口正确打开
- [ ] 聊天窗口已存在时正确聚焦
- [ ] 设置窗口正确打开
- [ ] 设置窗口已存在时正确聚焦
- [ ] 窗口尺寸正确（聊天 800x600，设置 1000x600）
- [ ] 窗口居中显示

---

### 测试 2: 托盘菜单打开设置窗口
**步骤:**
1. 点击托盘图标
2. 选择「设置」菜单项
3. 验证设置窗口是否打开
4. 关闭设置窗口
5. 再次从托盘打开设置
6. 验证窗口是否重新创建

**预期结果:**
- [ ] 托盘菜单可以打开设置窗口
- [ ] 窗口聚焦逻辑正常

---

### 测试 3: 快捷键打开聊天窗口
**步骤:**
1. 打开设置中心 → 智能助手标签
2. 设置「打开聊天」快捷键为 `Cmd+Shift+C` (macOS) 或 `Ctrl+Shift+C` (Windows/Linux)
3. 保存设置
4. 按下快捷键
5. 验证聊天窗口是否打开
6. 聊天窗口已打开时，再次按快捷键
7. 验证窗口是否聚焦

**预期结果:**
- [ ] 快捷键可以打开聊天窗口
- [ ] 窗口已存在时聚焦而非创建新窗口
- [ ] macOS 使用 Cmd 修饰键
- [ ] Windows/Linux 使用 Ctrl 修饰键
- [ ] 控制台输出 `[ShortcutManager] Triggered: openChat`
- [ ] 控制台输出 `[WindowManager] Created new window: chat` 或 `Focused existing window: chat`

---

### 测试 4: 快捷键打开设置窗口
**步骤:**
1. 设置「打开设置」快捷键为 `Cmd+Shift+S` (macOS) 或 `Ctrl+Shift+S` (Windows/Linux)
2. 保存设置
3. 按下快捷键
4. 验证设置窗口是否打开

**预期结果:**
- [ ] 快捷键可以打开设置窗口
- [ ] 窗口聚焦逻辑正常
- [ ] 控制台日志正确

---

### 测试 5: 快捷键冲突检测
**步骤:**
1. 尝试设置快捷键为 `Cmd+Q` (macOS 退出应用)
2. 查看控制台日志

**预期结果:**
- [ ] 控制台输出警告: `[ShortcutManager] Conflict detected: 系统保留键`
- [ ] 快捷键不会被注册

---

### 测试 6: 空快捷键处理
**步骤:**
1. 清空「打开聊天」快捷键配置
2. 保存设置
3. 验证应用不崩溃

**预期结果:**
- [ ] 应用正常运行
- [ ] 没有注册空快捷键
- [ ] 无错误日志

---

### 测试 7: 跨平台兼容性（如有条件）
**macOS 测试:**
- [ ] `Cmd+Shift+C` 打开聊天
- [ ] `Cmd+Shift+S` 打开设置

**Windows/Linux 测试:**
- [ ] `Ctrl+Shift+C` 打开聊天
- [ ] `Ctrl+Shift+S` 打开设置

---

### 测试 8: 开发模式 vs 生产模式 URL
**开发模式 (localhost:1420):**
- [ ] 聊天窗口 URL: `http://localhost:1420/chat.html`
- [ ] 设置窗口 URL: `http://localhost:1420/settings.html`

**生产模式 (打包后):**
- [ ] 聊天窗口 URL: `chat.html`
- [ ] 设置窗口 URL: `settings.html`

---

## 回归测试

### 确保未破坏现有功能
- [ ] 右键菜单其他功能正常（喂食、玩耍、睡觉等）
- [ ] 托盘菜单其他功能正常
- [ ] 宠物互动正常
- [ ] 状态栏显示正常
- [ ] 配置保存和加载正常

---

## 性能测试

### 窗口创建性能
**步骤:**
1. 快速连续按快捷键 5 次
2. 验证只创建一个窗口

**预期结果:**
- [ ] 只创建一个窗口实例
- [ ] 无重复创建
- [ ] 无内存泄漏警告

---

## 错误处理测试

### 窗口创建失败场景
**步骤:**
1. 检查控制台日志是否有错误捕获
2. 确保应用不会因为窗口创建失败而崩溃

**预期结果:**
- [ ] 错误被正确捕获
- [ ] 错误日志输出到控制台
- [ ] 应用继续运行

---

## 测试结果总结

**通过:** ___ / 总计: ___

**发现的问题:**
1.
2.
3.

**待修复:**
- [ ]
- [ ]

**备注:**


---

## 自动化测试建议（未来改进）

1. **单元测试**
   - WindowManager.openChatWindow() 正确性
   - WindowManager.openSettingsWindow() 正确性
   - getWindowUrl() 在不同环境下的返回值

2. **集成测试**
   - 快捷键注册流程
   - 窗口聚焦逻辑
   - 多窗口场景

3. **E2E 测试**
   - 使用 Playwright/Tauri WebDriver
   - 自动化快捷键测试
   - 自动化窗口打开测试
